<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Assinaturas Growin — Builder</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;margin:24px;color:#111}
  .wrap{display:grid;grid-template-columns:360px 1fr;gap:24px;align-items:start}
  label{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.04em;color:#555;margin:12px 0 4px}
  input,select{width:100%;padding:10px 12px;border:1px solid #d0d0d0;border-radius:8px;font-size:14px}
  .card{border:1px solid #e6e6e6;border-radius:12px;padding:16px}
  .btn{display:inline-block;border:0;border-radius:10px;padding:12px 14px;font-weight:600;cursor:pointer}
  .btn-primary{background:#e6443b;color:#fff}
  .btn-ghost{background:#f6f6f6}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .preview-wrap{background:#fff;border:1px dashed #ddd;border-radius:12px;padding:16px;overflow:auto}
  @media (max-width:900px){.wrap{grid-template-columns:1fr}}

  /* Responsive fixes */
  @media screen and (max-width:480px){
    .sig-wrap{font-size:70%!important;}
    .sig-col{display:block!important;width:100%!important;}
    .sig-divider{display:none!important;}
    .sig-right{text-align:center!important;}
    .sig-logo{max-width:170px!important;margin:8px auto 6px!important;}
    .sig-icons td{padding:0 6px!important;}
    .sig-photo{width:64px!important;height:64px!important;}
    .sig-iso{max-width:56px!important;}
  }
</style>
</head>
<body>
<h1 id="title-builder">Assinaturas Growin — Builder</h1>
<p style="max-width:600px">
  Campos personalizáveis: <strong>Nome</strong>, <strong>Cargo | Hobby</strong>, <strong>Telemóvel pessoal</strong>  
  e <strong>Morada do escritório</strong>.
</p>

<div class="wrap" id="builder-ui">
  <div class="card">

    <!-- MORADAS -->
    <label for="office">Morada</label>
    <select id="office">
      <option value="lisboa">Lisboa — Av. da República</option>
      <option value="porto">Porto — Av. da Boavista</option>
      <option value="bruxelas">Bruxelles — Rue des Colonies</option>
    </select>

    <label for="name">Nome</label>
    <input id="name" value="Filipa Freire">

    <label for="title">Cargo</label>
    <input id="title" value="GRAPHIC DESIGNER">

    <label for="hobby">Hobby</label>
    <input id="hobby" value="Crochet Crafter">

    <label for="mobile">Telemóvel pessoal</label>
    <input id="mobile" value="(+351) 934 556 060">

    <label for="photo">Nome do ficheiro da foto</label>
    <input id="photo" value="headshot-filipa-freire.png">

    <div class="row">
      <button id="copyBtn" class="btn btn-primary">Copiar assinatura</button>
      <button id="copyHtmlBtn" class="btn btn-ghost">Copiar HTML</button>
      <button id="copyLinkBtn" class="btn btn-ghost">Gerar link</button>
    </div>
  </div>

  <div>
    <div class="preview-wrap">
      <div id="preview"></div>
    </div>
  </div>
</div>

<script>
// Helpers
const qs=s=>document.querySelector(s);
const nobreak=str=>(str||"").trim().replace(/\s+/g,'&nbsp;');
const digitsHref=s=>{
  const raw=(s||"").replace(/[^\d+]/g,"");
  return /^9\d{8}$/.test(raw)? "+351"+raw : raw||"+3519XXXXXXXX";
};

const DEFAULT_HOST="https://growinassinaturas.github.io/email-signatures";
const params=new URLSearchParams(location.search);
const initialHost=params.get("host")||DEFAULT_HOST;

// Moradas configuráveis
const ADDRESS_MAP={
  lisboa:"Avenida da República,&nbsp;57,&nbsp;4.º&nbsp;andar,&nbsp;1050-189,&nbsp;Lisboa",
  porto:"Avenida da Boavista,&nbsp;nº&nbsp;1773,&nbsp;B2.5,&nbsp;4100-133&nbsp;Porto",
  bruxelas:"Rue&nbsp;des&nbsp;Colonies,&nbsp;11,&nbsp;1000&nbsp;Bruxelles"
};

function signatureHTML({name,title,hobby,mobile,photo,office,host}){
  const H=(host||DEFAULT_HOST).replace(/\/+$/,"");

  const addrKey = ADDRESS_MAP[office] ? office : "lisboa";
  const addressHTML = ADDRESS_MAP[addrKey];

  const mobileHref = digitsHref(mobile);
  const mobileHTML = nobreak(mobile);

  // Construção do URL da foto
  let photoUrl=(photo||"").trim();
  if(!/^https?:\/\//i.test(photoUrl)) photoUrl = `${H}/${photoUrl}`;

  return `
<table role="presentation" cellpadding="0" cellspacing="0" border="0" class="sig-wrap"
 style="border-collapse:collapse;font-family:Arial,Helvetica,sans-serif;color:#333;font-size:50%;">
<tr>

  <!-- FOTO -->
  <td class="sig-col" valign="top" style="padding:8px 12px 8px 0;">
    <img src="${photoUrl}" width="80" height="80"
         style="display:block;border:0;border-radius:50%;width:80px;height:80px;">
  </td>

  <!-- NOME + CONTACTOS -->
  <td class="sig-col" valign="top" style="padding:8px 16px 8px 0;">
    <table role="presentation">
      <tr><td style="font-size:16px;font-weight:800;color:#e6443b;">${name}</td></tr>
      <tr><td style="font-size:12px;font-weight:700;color:#555;">${title} | ${hobby}</td></tr>

      <tr><td style="font-size:12px;color:#444;padding:4px 0;">
        <strong style="color:#e6443b;">T:</strong>
        <a href="tel:${mobileHref}" style="color:#444;text-decoration:none;white-space:nowrap;">
          ${mobileHTML}
        </a>
      </td></tr>

      <tr><td style="font-size:11px;color:#666;padding:3px 0;">
        <span style="display:inline-block;background:#e6443b;width:18px;height:18px;border-radius:50%;text-align:center;line-height:18px;margin-right:5px;">
          <img src="${H}/icon-telemovel.png" width="9" style="vertical-align:middle;">
        </span>
        (+351)&nbsp;215&nbsp;947&nbsp;950
      </td></tr>

      <tr><td style="font-size:11px;color:#666;white-space:nowrap;">
        <span style="display:inline-block;background:#e6443b;width:18px;height:18px;border-radius:50%;text-align:center;line-height:18px;margin-right:5px;">
          <img src="${H}/icon-local.png" width="9" style="vertical-align:middle;">
        </span>
        ${addressHTML}
      </td></tr>
    </table>
  </td>

  <!-- DIVISOR -->
  <td class="sig-divider" valign="middle" style="padding:0 16px 0 0;">
    <table height="80"><tr><td style="border-left:2px solid #e6443b;">&nbsp;</td></tr></table>
  </td>

  <!-- LOGO + ICONS -->
  <td class="sig-col sig-right" valign="middle" style="padding:8px 0;">
    <table role="presentation" align="center">
      <tr><td align="center" style="padding-bottom:6px;">
        <img src="${H}/growin-logo.png"
             style="max-width:190px;display:block;margin:0 auto;">
      </td></tr>

      <tr><td align="center">
        <table cellpadding="0" cellspacing="0" border="0" class="sig-icons">
          <tr>
            <td style="padding-right:6px;">
              <a href="https://www.growin.com/" target="_blank"
                 style="display:inline-block;background:#e6443b;width:22px;height:22px;border-radius:50%;text-align:center;">
                <img src="${H}/icon-website.png" width="10" style="margin-top:6px;">
              </a>
            </td>

            <td style="padding-right:8px;">
              <a href="https://www.linkedin.com/company/growin/" target="_blank"
                 style="display:inline-block;background:#e6443b;width:22px;height:22px;border-radius:50%;text-align:center;">
                <img src="${H}/icon-linkedin.png" width="10" style="margin-top:6px;">
              </a>
            </td>

            <td>
              <img src="${H}/certificacao-iso.png" style="max-width:52px;">
            </td>
          </tr>
        </table>
      </td></tr>
    </table>
  </td>

</tr>
</table>
`;
}

const state={host:initialHost};

function readForm(){
  Object.assign(state,{
    office:qs("#office").value,
    name:qs("#name").value||"NOME APELIDO",
    title:qs("#title").value||"CARGO",
    hobby:qs("#hobby").value||"Hobby",
    mobile:qs("#mobile").value||"(+351) 9XX XXX XXX",
    photo:qs("#photo").value
  });
}

function render(){ qs("#preview").innerHTML=signatureHTML(state); }

function buildLink(){
  readForm();
  const base=location.origin+location.pathname;
  const qsParams=new URLSearchParams({
    o:state.office,
    n:state.name,
    t:state.title,
    h:state.hobby,
    m:state.mobile,
    p:state.photo,
    host:state.host
  });
  return `${base}?${qsParams.toString()}`;
}

qs("#copyBtn").onclick = () => window.open(buildLink(), "_blank");
qs("#copyHtmlBtn").onclick = async ()=>{readForm();await navigator.clipboard.writeText(signatureHTML(state));alert("HTML copiado!");};
qs("#copyLinkBtn").onclick = async ()=>{await navigator.clipboard.writeText(buildLink());alert("Link copiado!");};

["#office","#name","#title","#hobby","#mobile","#photo"].forEach(id=>{
  qs(id).addEventListener("input",()=>{readForm();render();});
});

// Modo assinatura isolada
const hasSigParams =
  params.has("n")||params.has("t")||params.has("h")||params.has("m")||params.has("p");

if(hasSigParams){
  const d=k=>decodeURIComponent((params.get(k)||"").replace(/\+/g," "));
  document.body.innerHTML = signatureHTML({
    office:d("o")||"lisboa",
    name:d("n")||"NOME APELIDO",
    title:d("t")||"CARGO",
    hobby:d("h")||"Hobby",
    mobile:d("m")||"(+351) 9XX XXX XXX",
    photo:d("p")||"headshot-default.png",
    host:d("host")||DEFAULT_HOST
  });
} else {
  readForm();
  render();
}
</script>
</body>
</html>
